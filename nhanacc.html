<!DOCTYPE html>
<html>
<head>
  <title>Đang random acc...</title>
</head>
<body>

<h2>ACC CỦA BẠN</h2>
<div id="acc">Đang tải...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, getDocs, doc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  projectId: "PROJECT_ID",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function randomAcc() {

  const querySnapshot = await getDocs(collection(db, "accounts"));

  let list = [];

  querySnapshot.forEach(docSnap => {
    if (docSnap.data().status === "ready") {
      list.push({
        id: docSnap.id,
        ...docSnap.data()
      });
    }
  });

  if (list.length === 0) {
    document.getElementById("acc").innerHTML = "❌ Hết acc rồi";
    return;
  }

  let acc = list[Math.floor(Math.random() * list.length)];

  // đổi trạng thái thành used
  await updateDoc(doc(db, "accounts", acc.id), {
    status: "used"
  });

  document.getElementById("acc").innerHTML =
    `Username: ${acc.username}<br>Password: ${acc.password}`;
}

randomAcc();
</script>

</body>
</html>
