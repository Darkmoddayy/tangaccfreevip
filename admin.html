<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#000;color:#0ff;font-family:sans-serif;text-align:center}
.box{border:2px solid #0ff;margin:20px;padding:20px;box-shadow:0 0 15px #0ff}
input,textarea,button{width:90%;margin:10px;padding:10px}
button{background:#0ff;border:none;font-weight:bold}
</style>
</head>

<body>

<div id="login" class="box">
<h2>ğŸ” ADMIN LOGIN</h2>
<input type="password" id="pass">
<button onclick="login()">ÄÄƒng nháº­p</button>
<p id="msg"></p>
</div>

<div id="panel" style="display:none">

<div class="box">
<h2>âš¡ ADMIN DASHBOARD</h2>
<p>ğŸ“¦ Tá»•ng acc: <span id="total">0</span></p>
<p>ğŸ‘¥ Online: <span id="online">0</span></p>
<button onclick="logout()">ÄÄƒng xuáº¥t</button>
</div>

<div class="box">
<h3>ğŸ“¦ Import acc</h3>
<textarea id="list" placeholder="tk|mk"></textarea>
<button onclick="importAcc()">IMPORT</button>
</div>

<div class="box">
<h3>ğŸ“‹ Danh sÃ¡ch acc</h3>
<div id="accList"></div>
<button onclick="deleteAll()">ğŸ—‘ XÃ“A Táº¤T Cáº¢</button>
</div>

<div class="box">
<h3>ğŸ“ˆ User theo ngÃ y</h3>
<canvas id="chart"></canvas>
</div>

<div class="box">
<h3>ğŸ† Top user</h3>
<div id="top"></div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
getDatabase,ref,set,push,onValue,remove,get
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
apiKey: "AIzaSyCNeMxQYCA3C58k1RtC4XyKayQnk-xYxkg",
authDomain: "tangaccfreevip-2f58c.firebaseapp.com",
databaseURL: "https://tangaccfreevip-2f58c-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId: "tangaccfreevip-2f58c"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.login = function(){

if(localStorage.fail>=5){
msg.innerText="âŒ Bá»‹ khÃ³a"
return
}

if(pass.value=="123456"){
login.style.display="none"
panel.style.display="block"
loadAcc()
loadStats()
}else{
localStorage.fail=(+localStorage.fail||0)+1
msg.innerText="âŒ Sai máº­t kháº©u"
}

}

window.logout=()=>location.reload()

function importAcc(){

let lines=list.value.split("\n")

lines.forEach(acc=>{
if(acc.trim()){
push(ref(db,"accounts"),{acc})
}
})

list.value=""
}

function loadAcc(){

onValue(ref(db,"accounts"),snap=>{

accList.innerHTML=""
let total=0

snap.forEach(i=>{
total++

accList.innerHTML+=`
<div>
${i.val().acc}
<button onclick="del('${i.key}')">âŒ</button>
</div>`
})

document.getElementById("total").innerText=total

})

}

window.del=id=>remove(ref(db,"accounts/"+id))

window.deleteAll=()=>remove(ref(db,"accounts"))

onValue(ref(db,"online"),snap=>{
online.innerText=snap.size||0
})

function loadStats(){

onValue(ref(db,"stats"),snap=>{

let labels=[]
let data=[]

snap.forEach(i=>{
labels.push(i.key)
data.push(i.val())
})

new Chart(chart,{
type:"line",
data:{labels,datasets:[{label:"User",data}]}
})

})

}

onValue(ref(db,"top"),snap=>{
top.innerHTML=""
snap.forEach(i=>{
top.innerHTML+=`<p>${i.key}: ${i.val()}</p>`
})
})

</script>
</body>
</html>
