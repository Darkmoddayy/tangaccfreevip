<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>DARKMODDAYY MAX LEVEL</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<div id="userBox" class="box">
<h1>ğŸ NHáº¬N ACC VIP</h1>
<h2> 99% cÃ³ tá»‰ lá»‡ ra acc lv1500-lvmax
<2> 1% cÃ³ tá»‰ lá»‡ ra dragon
  
<h2 id="totalAcc"></h2>
<button onclick="nhanAcc()">NHáº¬N ACC</button>
<h2 id="status"></h2>
</div>

<div id="adminBox" style="display:none">

<div class="box">
<h2>ğŸ” ADMIN LOGIN</h2>
<input type="password" id="pass">
<button onclick="login()">ÄÄƒng nháº­p</button>
<h3 id="msg"></h3>
</div>

<div id="panel" style="display:none">

<div class="box">
<h2>ğŸ“¦ ThÃªm acc</h2>
<input id="acc">
<button onclick="addAcc()">ThÃªm</button>

<textarea id="bulk" placeholder="Import acc má»—i dÃ²ng"></textarea>
<button onclick="importAcc()">IMPORT</button>
</div>

<div class="box">
<h2>ğŸ“‹ ACC LIST</h2>
<ul id="list"></ul>
<h3>Tá»•ng: <span id="total"></span></h3>
</div>

<div class="box">
<h2>ğŸ† TOP USER</h2>
<div id="topUser"></div>
</div>

<div class="box">
<h2>ğŸ“Š USER THEO NGÃ€Y</h2>
<canvas id="chart"></canvas>
</div>

<div class="box">
ğŸ‘¥ Online: <span id="online"></span>
</div>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, get, set, remove, push, onValue } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const app = initializeApp({
apiKey:"AIzaSyCNeMxQYCA3C58k1RtC4XyKayQnk-xYxkg",
databaseURL:"https://tangaccfreevip-2f58c-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db=getDatabase(app);

// ADMIN URL SECRET
const url=new URLSearchParams(window.location.search);
if(url.get("darkmod")=="vipadmin"){
adminBox.style.display="block";
userBox.style.display="none";
}

// DEVICE ID
const device=localStorage.getItem("device")||Math.random();
localStorage.setItem("device",device);

// ONLINE TRACK
set(ref(db,"online/"+device),true);

// TOTAL ACC REALTIME
onValue(ref(db,"accounts"),snap=>{
totalAcc.innerHTML="ğŸ“¦ Acc cÃ²n: "+snap.size;
});

// NHáº¬N ACC
window.nhanAcc=async()=>{

status.innerHTML="â³ Äang kiá»ƒm tra vÆ°á»£t link...";

if(!url.get("done")){
location.href="https://link4m.co/st?api=69100b1afc003f0eba59c189&url="+encodeURIComponent(location.href+"?done=1");
return;
}

let today=new Date().toISOString().slice(0,10);

let userRef=ref(db,"users/"+device);
let snap=await get(userRef);

let data=snap.val()||{count:0,date:today};

if(data.date!==today){
data.count=0;
data.date=today;
}

if(data.count>=2){
status.innerHTML="âŒ ÄÃ£ nháº­n 2 acc hÃ´m nay";
return;
}

let accSnap=await get(ref(db,"accounts"));

if(!accSnap.exists()){
status.innerHTML="ğŸ”¥ Háº¾T ACC ğŸ”¥";
return;
}

let list=accSnap.val();
let keys=Object.keys(list);
let rand=keys[Math.floor(Math.random()*keys.length)];
let acc=list[rand];

await remove(ref(db,"accounts/"+rand));

data.count++;
await set(userRef,data);

// LOG HISTORY
push(ref(db,"logs"),{
device:device,
acc:acc,
time:new Date().toLocaleString()
});

status.innerHTML="âœ… "+acc;
};

// LOGIN ADMIN
let fail=0;

window.login=()=>{
if(pass.value==="123456"){
panel.style.display="block";
loadAdmin();
}else{
fail++;
msg.innerHTML="âŒ Sai máº­t kháº©u";
if(fail>=5){
msg.innerHTML="ğŸ”’ KhÃ³a 5 phÃºt";
setTimeout(()=>fail=0,300000);
}
}
};

// ADMIN LOAD
function loadAdmin(){

onValue(ref(db,"accounts"),snap=>{
let html="";
let total=0;

snap.forEach(i=>{
total++;
html+=`<li>${i.val()} <button onclick="delAcc('${i.key}')">X</button></li>`;
});

list.innerHTML=html;
document.getElementById("total").innerHTML=total;
});

// ONLINE
onValue(ref(db,"online"),snap=>{
online.innerHTML=snap.size;
});

// TOP USER
onValue(ref(db,"users"),snap=>{
let arr=[];
snap.forEach(i=>arr.push(i.val().count||0));
arr.sort((a,b)=>b-a);
topUser.innerHTML=arr.slice(0,5).join("<br>");
});

// CHART
onValue(ref(db,"logs"),snap=>{
let map={};

snap.forEach(i=>{
let d=i.val().time.split(",")[0];
map[d]=(map[d]||0)+1;
});

new Chart(chart,{
type:"line",
data:{
labels:Object.keys(map),
datasets:[{label:"LÆ°á»£t nháº­n",data:Object.values(map)}]
}
});
});

}

// ADD ACC
window.addAcc=()=>{
push(ref(db,"accounts"),acc.value);
acc.value="";
};

// IMPORT
window.importAcc=()=>{
bulk.value.split("\n").forEach(a=>{
if(a.trim()!="") push(ref(db,"accounts"),a);
});
bulk.value="";
};

// DELETE
window.delAcc=(id)=>{
remove(ref(db,"accounts/"+id));
};

</script>
</body>
</html>
