<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>T·∫∑ng Acc VIP</title>
<style>
body{background:#06141b;color:#0ff;text-align:center;font-family:Arial}
.box{margin-top:80px;padding:30px;border:2px solid #0ff;box-shadow:0 0 20px #0ff}
button{padding:15px 30px;background:#00ffd5;border:none;font-weight:bold}
</style>
</head>

<body>

<div class="box">
<h1>üéÅ T·∫∂NG ACC FREE VIP</h1>
<h2 id="count">0</h2>

<button onclick="getAcc()">NH·∫¨N ACC NGAY</button>

<h3 id="loading"></h3>
<h2 id="acc"></h2>
</div>

<script type="module">

import { firebaseConfig } from "./config.js";
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, onValue, get, child, remove, set } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const device = localStorage.getItem("device") || Math.random().toString(36);
localStorage.setItem("device",device);

function today(){
return new Date().toISOString().slice(0,10);
}

onValue(ref(db,"acc"),snap=>{
document.getElementById("count").innerHTML=snap.size;
})

window.getAcc = async function(){

const userRef = ref(db,"users/"+device);

const snap = await get(userRef);

let data = snap.val();

if(data && data.date===today() && data.count>=2){
alert("‚ùå B·∫°n ƒë√£ nh·∫≠n ƒë·ªß h√¥m nay");
return;
}

document.getElementById("loading").innerHTML="‚è≥ ƒêang ki·ªÉm tra v∆∞·ª£t link...";

setTimeout(async()=>{

const accSnap = await get(child(ref(db),"acc"));

let arr=[];

accSnap.forEach(i=>arr.push({key:i.key,val:i.val()}));

let random = arr[Math.floor(Math.random()*arr.length)];

document.getElementById("acc").innerHTML=random.val;

remove(ref(db,"acc/"+random.key));

set(userRef,{
date:today(),
count:(data?.count||0)+1
});

},3000)

}

</script>
</body>
</html>
