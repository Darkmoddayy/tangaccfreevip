<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NHáº¬N ACC VIP</title>

<style>
body{background:#000;color:#0ff;font-family:Arial;text-align:center}
.box{
margin:30px auto;
padding:20px;
width:90%;
max-width:420px;
border:2px solid #0ff;
border-radius:15px;
box-shadow:0 0 25px #0ff;
}
button{
padding:12px 25px;
border:none;
border-radius:10px;
background:#0ff;
font-weight:bold;
}
.lock{filter:blur(2px);background:gray}
.progress{height:10px;background:#111;border-radius:10px;overflow:hidden}
.bar{height:100%;background:#0ff;width:0%}
.acc{background:#111;margin:5px;padding:10px;border-radius:10px}
</style>
</head>

<body>

<div class="box">

<h2>ğŸ NHáº¬N ACC VIP</h2>

<div>ğŸ“¦ Acc cÃ²n: <span id="total">0</span></div>
<div>ğŸ‘¥ Online: <span id="online">0</span></div>

<div class="progress"><div class="bar" id="bar"></div></div>

<button id="btn" onclick="nhanAcc()">NHáº¬N ACC</button>

<div id="loading"></div>
<div id="historyBox"></div>
<div id="top"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
getDatabase, ref, onValue, push, remove, set, onDisconnect
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const app = initializeApp({
databaseURL:"https://tangaccfreevip-2f58c-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = getDatabase(app);

const accRef = ref(db,"accounts");
const historyRef = ref(db,"history");
const onlineRef = ref(db,"online");

const device = localStorage.getItem("device") || Date.now();
localStorage.setItem("device",device);

let count = localStorage.getItem("count") || 0;

// reset 0h
const today = new Date().toLocaleDateString();
if(localStorage.getItem("date") != today){
localStorage.setItem("date",today);
localStorage.setItem("count",0);
count = 0;
}

updateBar();

// online realtime
set(ref(db,"online/"+device),true);
onDisconnect(ref(db,"online/"+device)).remove();

onValue(onlineRef,snap=>{
document.getElementById("online").innerText = snap.size;
});

// load acc
onValue(accRef,snap=>{
document.getElementById("total").innerText = snap.size;
snap.size == 0 ? lockBtn() : unlockBtn();
});

function updateBar(){
document.getElementById("bar").style.width = (count/2)*100+"%";
}

window.nhanAcc = function(){

if(count>=2){
boom();
alert("Báº¡n Ä‘Ã£ nháº­n tá»‘i Ä‘a 2 acc/ngÃ y");
return;
}

document.getElementById("loading").innerHTML="â³ Äang kiá»ƒm tra vÆ°á»£t link...";

setTimeout(()=>{

onValue(accRef,snap=>{

const arr=[];
snap.forEach(i=>arr.push({key:i.key,text:i.val().text}));

if(arr.length==0) return;

const rand = arr[Math.floor(Math.random()*arr.length)];

push(historyRef,{
text:rand.text,
device:device,
time:Date.now()
});

remove(ref(db,"accounts/"+rand.key));

count++;
localStorage.setItem("count",count);
updateBar();

document.getElementById("loading").innerHTML="âœ… "+rand.text;

loadHistory();
loadTop();

},{onlyOnce:true});

},2000);
}

// history
function loadHistory(){
onValue(historyRef,snap=>{
let html="<h4>ğŸ“œ Acc Ä‘Ã£ nháº­n</h4>";
snap.forEach(i=>{
if(i.val().device==device){
html+=`<div class="acc">${i.val().text}</div>`;
}
});
historyBox.innerHTML=html;
});
}
loadHistory();

// TOP USER
function loadTop(){
onValue(historyRef,snap=>{
const data={};
snap.forEach(i=>{
const d=i.val().device;
data[d]=(data[d]||0)+1;
});
let html="<h4>ğŸ† TOP USER</h4>";
Object.values(data).sort((a,b)=>b-a).slice(0,3)
.forEach(v=>html+=`<div class="acc">${v} acc</div>`);
top.innerHTML=html;
});
}
loadTop();

function lockBtn(){btn.classList.add("lock");btn.disabled=true;}
function unlockBtn(){btn.classList.remove("lock");btn.disabled=false;}

function boom(){
document.body.style.background="red";
setTimeout(()=>document.body.style.background="#000",300);
}

</script>
</body>
</html>
